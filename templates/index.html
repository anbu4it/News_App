{% extends 'base.html' %}

{% block content %}

<!-- ===== Page Heading ===== -->
<div class="container my-5 text-center">
    <h1 class="display-5 fw-bold">Latest Tech News</h1>
    <p class="text-muted">Stay updated with the latest news and articles from the tech world</p>
</div>

<!-- ===== Top Carousel (Hero Section) ===== -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css"/>
<div class="container-fluid px-5 my-4">
    <div class="swiper large-carousel">
        <div class="swiper-wrapper">
            {% for article in articles[:7] %}
            <div class="swiper-slide text-center position-relative">
                <a href="{{ url_for('article', article_id=article.id) }}">
                    <img 
                        src="{{ article.image_url or url_for('static', filename='fallback.jpg') }}" 
                        onerror="this.onerror=null;this.src='{{ url_for('static', filename='fallback.jpg') }}';"
                        class="img-fluid rounded shadow carousel-img" 
                        loading="lazy" 
                        alt="{{ article.title }}"
                    >
                    <div class="carousel-title-overlay">
                        <h4>{{ article.title }}</h4>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
    </div>
</div>

<!-- ===== Featured Articles Grid ===== -->
<div class="container my-5">
    <h2 class="fw-bold mb-4">More Articles</h2>
    <div class="row g-4">
        {% for article in articles %}
        <div class="col-lg-4 col-md-6 d-flex">
            <div class="card flex-fill shadow-sm hover-card" style="margin-bottom: 15px;">
                <a href="{{ url_for('article', article_id=article.id) }}">
                    <img 
                        src="{{ article.image_url or url_for('static', filename='fallback.jpg') }}" 
                        onerror="this.onerror=null;this.src='{{ url_for('static', filename='fallback.jpg') }}';"
                        class="card-img-top" 
                        alt="{{ article.title }}" 
                        loading="lazy" 
                        style="height:220px; object-fit:cover;"
                    >
                </a>
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">{{ article.title }}</h5>
                    <p class="card-text text-truncate">{{ article.description }}</p>
                    <a href="{{ url_for('article', article_id=article.id) }}" class="mt-auto btn btn-primary btn-sm">Read More</a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- ===== Scripts ===== -->
<script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>
<script>
const swiper = new Swiper('.swiper.large-carousel', {
    slidesPerView: 3,
    spaceBetween: 40,
    centeredSlides: true,
    loop: true,
    autoplay: {
        delay: 3000,
        disableOnInteraction: false,
    },
    navigation: {
        nextEl: '.swiper-button-next',
        prevEl: '.swiper-button-prev',
    },
    breakpoints: {
        992: { slidesPerView: 3 },
        768: { slidesPerView: 2 },
        0: { slidesPerView: 1 }
    },
    on: {
        slideChangeTransitionStart: function() {
            this.slides.forEach((slide, index) => {
                const title = slide.querySelector('h4');
                if (index === this.activeIndex) {
                    slide.style.transform = 'scale(1.2) translateY(-15px)';
                    slide.style.opacity = '1';
                    slide.style.zIndex = '10';
                    if (title) title.style.display = 'block';
                } else if (index === this.activeIndex - 1 || index === this.activeIndex + 1) {
                    slide.style.transform = 'scale(0.95) translateY(0)';
                    slide.style.opacity = '0.7';
                    slide.style.zIndex = '5';
                    if (title) title.style.display = '-webkit-box';
                } else {
                    slide.style.transform = 'scale(0.85) translateY(10px)';
                    slide.style.opacity = '0.5';
                    slide.style.zIndex = '1';
                    if (title) title.style.display = '-webkit-box';
                }
            });
        }
    }
});
</script>

<!-- ===== Styles ===== -->
<style>
/* ===== Carousel Styling ===== */
.carousel-img {
    height: 420px; /* Bigger carousel */
    min-height: 420px;
    width: 100%;
    object-fit: cover;
    border-radius: 12px;
    transition: transform 0.4s, opacity 0.4s;
    background-color: #f1f1f1;
}

/* Overlay for titles */
.carousel-title-overlay {
    position: absolute;
    bottom: 0;
    width: 100%;
    padding: 1rem;
    background: linear-gradient(transparent, rgba(0, 0, 0, 0.6));
    color: white;
    text-align: center;
    transition: all 0.3s;
}

.carousel-title-overlay h4 {
    font-size: 1.2rem;
    font-weight: 600;
    margin: 0;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
}

.swiper-slide-active .carousel-title-overlay h4 {
    -webkit-line-clamp: unset;
    font-size: 1.3rem;
    display: block;
    font-weight: 700;
    margin-bottom: 20px;
}

/* ===== Grid Styling ===== */
.card-img-top {
    background-color: #f8f9fa;
    min-height: 220px;
}

.card-text {
    max-height: 3rem;
    overflow: hidden;
}

/* Hover effect */
.hover-card:hover {
    transform: translateY(-5px);
    transition: transform 0.3s;
}

/* Spacing between carousel and grid */
.swiper + .container {
    margin-top: 90px;
}

/* ===== Responsive ===== */
@media (max-width: 992px) {
    .carousel-img {
        height: 320px;
    }
}

@media (max-width: 768px) {
    .carousel-img {
        height: 240px;
    }
}
</style>

{% endblock %}
